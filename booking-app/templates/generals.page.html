{{template "base" .}}
{{define "content"}}
<div class="container">
  <div class="row mt-4">
    <div class="col">
      <img src="/static/images/generals-quarters.png" class="img-fluid img-thumbnail mx-auto d-block room-image" alt="room-img">
    </div>
  </div>
  <div class="row">
    <div class="col">
      <h1 class="text-center mt-4">Generals Quarters</h1>
      <p>
        Lorem ipsum, dolor sit amet consectetur adipisicing elit. Perspiciatis optio asperiores inventore. Ullam consectetur 
        minus distinctio corrupti, facilis ex consequuntur corporis, molestiae, quos natus harum inventore libero labore.
        Laudantium sit sapiente aut, molestiae quae fuga. Labore earum vel magnam inventore molestias atque temporibus
        laudantium, quis totam deleniti assumenda facere? Ipsa, odit. Exercitationem maiores consequuntur molestiae?
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Sed eveniet aliquid atque doloremque, tempora inventore ex asperiores, 
        voluptatibus incidunt aspernatur quis officia nostrum quia eum placeat dicta ipsa, sunt fuga.
      </p>
    </div>
  </div>
  <div class="row">
    <div class="col text-center">
      <a id="check-availability-button" href="#!" class="btn btn-success">Check Availability</a>
    </div>
  </div>
</div>
{{end}}

{{define "js"}}
<script>
  document.getElementById("check-availability-button").addEventListener("click", function () {
    // Define the html form
    let html = `
    <form id="check-availability-form" action="" method="POST" novalidate class="needs-validation">
      <div class="row">
        <div class="col">
          <div id="reservation-dates-modal" class="row">
            <div class="col">
              <input disabled class="form-control" type="text" name="start" id="start" required placeholder="Arrival">
            </div>
            <div class="col">
              <input disabled class="form-control" type="text" name="end" id="end" required placeholder="Departure">
            </div>
          </div>
        </div>
      </div>
    </form>
    `;

    // Open a sweet alert passing the callback into it using fetch() to make a request.
    attention.custom({
      msg: html, 
      title: "Choose your dates",

      willOpen: () => {
        const elem = document.getElementById('reservation-dates-modal');
        const rp = new DateRangePicker(elem, {
          format: 'yyyy-mm-dd',
          showOnFocus: true,
          minDate: new Date(),
        })
      },

      didOpen: () => {
        document.getElementById('start').removeAttribute('disabled');
        document.getElementById('end').removeAttribute('disabled');
      },

      callback: function(result) {
        let form = document.getElementById("check-availability-form");
        let formData = new FormData(form);
        formData.append("csrf_token", "{{.CSRFToken}}")
        formData.append("room_id", "1");

        fetch('/search-availability-json', {
          method: "post",
          body: formData,
        })
          .then(response => {
            return response.json()
          })
          .then(data => {
            if (data.ok) {
              console.log("Room is available");
            } else {
              console.log("Room is not available");
            }
          })
      }
    });
  })
</script>
{{end}}